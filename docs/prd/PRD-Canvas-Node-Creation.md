# PRDï¼šç”»å¸ƒèŠ‚ç‚¹åˆ›å»ºä¸å¸ƒå±€ä¼˜åŒ–

## ğŸ“Œ åŠŸèƒ½æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°ç”»å¸ƒï¼ˆCanvasï¼‰ä¸­åˆ›å»ºèŠ‚ç‚¹ï¼ˆDocumentã€Whiteboardã€Sectionï¼‰çš„äº¤äº’é€»è¾‘ä¸å¸ƒå±€è§„åˆ™ã€‚

---

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

1. **ç®€åŒ–æ“ä½œæµç¨‹**ï¼šç”¨æˆ·ç‚¹å‡»èœå•é¡¹åï¼Œç›´æ¥åœ¨ç”»å¸ƒåˆ›å»ºå¯¹åº”èŠ‚ç‚¹
2. **é¿å…èŠ‚ç‚¹é‡å **ï¼šæ–°å¢èŠ‚ç‚¹è‡ªåŠ¨æ”¾ç½®åœ¨åˆé€‚ä½ç½®ï¼Œä¸ä¸ç°æœ‰èŠ‚ç‚¹é‡å 
3. **ä¿æŒè§†è§‰ä¸€è‡´**ï¼šæ‰€æœ‰èŠ‚ç‚¹é¡¶éƒ¨å¯¹é½ï¼Œæ•´é½æ’åˆ—
4. **æ™ºèƒ½è§†å›¾è·Ÿéš**ï¼šåˆ›å»ºèŠ‚ç‚¹åï¼Œç”»å¸ƒè‡ªåŠ¨å¹³ç§»ä½¿æ–°èŠ‚ç‚¹å±…ä¸­æ˜¾ç¤º

---

## ğŸ“‹ è¯¦ç»†è§„åˆ™

### 1. èœå•äº¤äº’

| äº¤äº’è¡Œä¸º | é¢„æœŸç»“æœ |
|---------|---------|
| ç‚¹å‡» "+" æŒ‰é’® | å±•å¼€åˆ›å»ºèœå• |
| ç‚¹å‡»èœå•é¡¹ï¼ˆDocument/Whiteboard/Sectionï¼‰ | ç›´æ¥åˆ›å»ºèŠ‚ç‚¹ï¼Œèœå•è‡ªåŠ¨å…³é—­ |
| ç‚¹å‡»èœå•å¤–éƒ¨åŒºåŸŸ | èœå•è‡ªåŠ¨å…³é—­ |

### 2. èŠ‚ç‚¹å°ºå¯¸å®šä¹‰

| èŠ‚ç‚¹ç±»å‹ | å®½åº¦ (px) | é«˜åº¦ (px) |
|---------|----------|----------|
| Document | 450 | 550 |
| Whiteboard | 850 | 700 |
| Section | 400 | 300 |

### 3. èŠ‚ç‚¹ä½ç½®è®¡ç®—é€»è¾‘

#### 3.1 é¦–ä¸ªèŠ‚ç‚¹
- **ä½ç½®**ï¼šç”»å¸ƒå¯è§†åŒºåŸŸçš„æ­£ä¸­å¤®
- **è®¡ç®—æ–¹å¼**ï¼š
  ```
  X = ç”»å¸ƒä¸­å¿ƒX - èŠ‚ç‚¹å®½åº¦ / 2
  Y = ç”»å¸ƒä¸­å¿ƒY - èŠ‚ç‚¹é«˜åº¦ / 2
  ```

#### 3.2 åç»­èŠ‚ç‚¹
- **æ°´å¹³ä½ç½®**ï¼šæ”¾ç½®åœ¨æ‰€æœ‰ç°æœ‰èŠ‚ç‚¹ï¼ˆDocument + Whiteboardï¼‰çš„æœ€å³ä¾§
- **å‚ç›´ä½ç½®**ï¼šä¸ç°æœ‰èŠ‚ç‚¹**é¡¶éƒ¨å¯¹é½**ï¼ˆä½¿ç”¨æœ€é ä¸Šçš„ Y åæ ‡ï¼‰
- **é—´è·**ï¼šä¸æœ€å³ä¾§èŠ‚ç‚¹ä¿æŒ **40px** é—´éš”

- **è®¡ç®—æ–¹å¼**ï¼š
  ```
  X = æœ€å³ä¾§èŠ‚ç‚¹çš„å³è¾¹ç¼˜ + 40px
  Y = æ‰€æœ‰èŠ‚ç‚¹ä¸­æœ€å°çš„ Y å€¼ï¼ˆé¡¶éƒ¨å¯¹é½ï¼‰
  ```

### 4. è§†å›¾è‡ªåŠ¨è°ƒæ•´

åˆ›å»ºèŠ‚ç‚¹åï¼Œç”»å¸ƒè§†å›¾è‡ªåŠ¨å¹³ç§»ï¼Œä½¿æ–°åˆ›å»ºçš„èŠ‚ç‚¹å±…äºå¯è§†åŒºåŸŸä¸­å¤®ã€‚

- **è®¡ç®—æ–¹å¼**ï¼š
  ```
  æ–°è§†å›¾X = å±å¹•ä¸­å¿ƒX - æ–°èŠ‚ç‚¹ä¸­å¿ƒX Ã— ç¼©æ”¾æ¯”ä¾‹
  æ–°è§†å›¾Y = å±å¹•ä¸­å¿ƒY - æ–°èŠ‚ç‚¹ä¸­å¿ƒY Ã— ç¼©æ”¾æ¯”ä¾‹
  ```

---

## ğŸ–¼ï¸ è§†è§‰æ•ˆæœç¤ºæ„

### é¦–æ¬¡åˆ›å»º Document
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚              â”‚ Document  â”‚              â”‚
â”‚              â”‚           â”‚  â† å±å¹•ä¸­å¤®  â”‚
â”‚              â”‚           â”‚              â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å†åˆ›å»º Whiteboardï¼ˆç”»å¸ƒè‡ªåŠ¨å¹³ç§»ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Document  â”‚ â”‚    Whiteboard       â”‚  â”‚
â”‚  â”‚           â”‚ â”‚                     â”‚  â”‚
â”‚  â”‚           â”‚ â”‚         â† å±å¹•ä¸­å¤®  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                     â”‚  â”‚
â”‚       â†‘        â”‚                     â”‚  â”‚
â”‚    é¡¶éƒ¨å¯¹é½    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†40pxâ†’
```

### ç»§ç»­åˆ›å»º Document
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Doc 1  â”‚ â”‚    Whiteboard     â”‚ â”‚   Doc 2   â”‚    â”‚
â”‚  â”‚         â”‚ â”‚                   â”‚ â”‚           â”‚    â”‚
â”‚  â”‚         â”‚ â”‚                   â”‚ â”‚  â† ä¸­å¤®   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚              â”‚                   â”‚                  â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘              â†‘                   â†‘
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              æ‰€æœ‰èŠ‚ç‚¹é¡¶éƒ¨å¯¹é½
```

---

## ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

### å…³é”®å‡½æ•°ï¼š`createNodeAtCenter`

```typescript
const createNodeAtCenter = (type: 'document' | 'whiteboard' | 'section') => {
  // 1. è·å–å®¹å™¨å°ºå¯¸å’Œå½“å‰è§†å›¾å‚æ•°
  const container = containerRef.current;
  const rect = container.getBoundingClientRect();
  
  // 2. å®šä¹‰èŠ‚ç‚¹é—´è·
  const GAP = 40;
  
  // 3. è®¡ç®—ç”»å¸ƒä¸­å¿ƒåæ ‡
  const canvasCenterX = (rect.width / 2 - view.x) / view.scale;
  const canvasCenterY = (rect.height / 2 - view.y) / view.scale;
  
  // 4. æŸ¥æ‰¾æ‰€æœ‰ç°æœ‰èŠ‚ç‚¹
  const allNodes = nodes.filter(n => 
    n.type === NodeType.DOCUMENT || n.type === NodeType.WHITEBOARD
  );
  
  // 5. è®¡ç®—æ–°èŠ‚ç‚¹ä½ç½®
  if (allNodes.length === 0) {
    // é¦–ä¸ªèŠ‚ç‚¹ï¼šå±…ä¸­æ”¾ç½®
    newX = canvasCenterX - width / 2;
    newY = canvasCenterY - height / 2;
  } else {
    // åç»­èŠ‚ç‚¹ï¼šå³ä¾§ + é¡¶éƒ¨å¯¹é½
    const rightmost = findRightmostNode(allNodes);
    const topmostY = Math.min(...allNodes.map(n => n.y));
    
    newX = rightmost.x + rightmost.width + GAP;
    newY = topmostY;  // é¡¶éƒ¨å¯¹é½
  }
  
  // 6. åˆ›å»ºèŠ‚ç‚¹
  onAddNode(newNode);
  
  // 7. è°ƒæ•´è§†å›¾ä½¿æ–°èŠ‚ç‚¹å±…ä¸­
  const newViewX = centerScreenX - (newX + width / 2) * view.scale;
  const newViewY = centerScreenY - (newY + height / 2) * view.scale;
  onViewChange({ ...view, x: newViewX, y: newViewY });
};
```

### èœå•çŠ¶æ€ç®¡ç†

```typescript
// ä½¿ç”¨ React state æ§åˆ¶èœå•å¼€å…³
const [isAddMenuOpen, setIsAddMenuOpen] = useState(false);
const addMenuRef = useRef<HTMLDivElement>(null);

// ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•
useEffect(() => {
  const handleClickOutside = (event: MouseEvent) => {
    if (addMenuRef.current && !addMenuRef.current.contains(event.target as Node)) {
      setIsAddMenuOpen(false);
    }
  };
  document.addEventListener('mousedown', handleClickOutside);
  return () => document.removeEventListener('mousedown', handleClickOutside);
}, []);
```

---

## âœ… éªŒæ”¶æ ‡å‡†

| # | æµ‹è¯•åœºæ™¯ | é¢„æœŸç»“æœ |
|---|---------|---------|
| 1 | ç©ºç”»å¸ƒï¼Œç‚¹å‡»åˆ›å»º Document | èŠ‚ç‚¹å‡ºç°åœ¨ç”»å¸ƒä¸­å¤® |
| 2 | å·²æœ‰ Documentï¼Œå†åˆ›å»º Document | æ–°èŠ‚ç‚¹åœ¨å³ä¾§ï¼Œé—´éš” 40pxï¼Œé¡¶éƒ¨å¯¹é½ |
| 3 | å·²æœ‰ Documentï¼Œåˆ›å»º Whiteboard | æ–°èŠ‚ç‚¹åœ¨å³ä¾§ï¼Œé—´éš” 40pxï¼Œé¡¶éƒ¨å¯¹é½ï¼ˆå°½ç®¡é«˜åº¦ä¸åŒï¼‰ |
| 4 | åˆ›å»ºä»»æ„èŠ‚ç‚¹å | ç”»å¸ƒè‡ªåŠ¨å¹³ç§»ï¼Œæ–°èŠ‚ç‚¹å±…ä¸­æ˜¾ç¤º |
| 5 | ç‚¹å‡»èœå•é¡¹å | èœå•è‡ªåŠ¨å…³é—­ |
| 6 | ç‚¹å‡»èœå•å¤–éƒ¨ | èœå•è‡ªåŠ¨å…³é—­ |

---

## ğŸ“ å˜æ›´è®°å½•

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ |
|-----|------|---------|
| 2025-12-22 | v1.0 | åˆç‰ˆå‘å¸ƒ |

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

- `components/Canvas/CanvasContainer.tsx` - ç”»å¸ƒå®¹å™¨ç»„ä»¶ï¼ŒåŒ…å«èŠ‚ç‚¹åˆ›å»ºé€»è¾‘

