# Chat 系统设计决策

> 本文档面向产品经理，分享 Chat 系统设计过程中的思考与取舍。

---

## 从一个用户焦虑说起

当 AI 不只是回答问题，而是帮你**执行一系列任务**时，你会发现传统的聊天界面完全不够用。

用户发送一条消息后，看到的是一个转圈的加载动画，然后……等待。30 秒、1 分钟、2 分钟。AI 在做什么？卡住了吗？要不要刷新页面？

这种焦虑来自于**信息黑箱**。

我们的解决方案是把消息拆成 5 种类型，每种解决一个具体问题：

- **问题卡片**：让用户参与决策，而不是被动等待
- **执行计划**：让用户知道「会做什么」
- **思考消息**：让用户知道「AI 没卡住」
- **操作反馈**：让用户知道「做了什么」

代价是界面复杂度增加了，但用户的焦虑消失了。

---

## 操作反馈的「分级展示」

AI 执行任务时会产生大量操作。如果全部以卡片形式展示：

> Read config.json  
> Search "user flow"  
> Read template.md  
> Search "navigation"  
> Read styles.css  
> **Create Document: User Personas**  
> Read persona-template.md  
> **Create Document: Product Charter**  
> ...

用户会直接跳过不看。信息过载导致的结果是**没有信息**。

所以我们做了分级：

**轻量操作**（grep/read/ls）用简化文本一笔带过，不打断阅读节奏。它们的存在只是为了证明「AI 确实在工作」，而不是让用户关注细节。

**重要操作**（创建节点、删除文件）用完整卡片展示，因为这些会产生实际结果，用户需要知道，也可能需要操作（比如点击定位按钮跳转到画布）。

有人问：为什么不全部折叠起来？因为那样用户会错过重要信息。为什么不全部隐藏轻量操作？因为那样用户不知道 AI 在做什么，又回到焦虑状态。

---

## 问题卡片：不是对话，也不是表单

收集用户决策，最自然的方式是对话：

> AI：你想做什么类型的产品？  
> 用户：电商  
> AI：目标用户是谁？  
> 用户：年轻人  
> ...

问题是，用户不知道要问多少个问题，也没法回看和修改之前的回答。

另一个极端是表单，一次性列出所有问题让用户填。但那样认知负担太重，用户看到 5 个问题会感到压力。

我们的问题卡片是个折中：

- 一次只展示一个问题（降低认知负担）
- 但显示总数（1/5，让用户知道还有多少）
- 选完自动跳下一题（保持节奏）
- 可以翻页回看（允许修改）
- 随时可以跳过或结束（给用户控制权）

选中后 300ms 延迟再跳转，是为了让用户看到「我选中了」的反馈。没有这个延迟，用户会怀疑自己的选择有没有被记录。

---

## 「开始执行」按钮的存在意义

AI 生成计划后，为什么不直接执行？为什么要多此一举让用户点一个按钮？

因为这个按钮代表的是**用户授权**。

点击之前，用户可以看到完整计划，如果不满意可以提出修改。点击之后，责任就从 AI 转移到了用户——「你同意了这个计划」。

这不只是产品设计，也是心理契约。用户会更信任一个「征求同意」的 AI，而不是「自作主张」的 AI。

按钮点击后立即消失，不是为了省空间，是为了防止用户重复点击导致任务执行两次。

---

## 为什么进度条要「悬浮」

进度条放在哪里，我们试过两种方案：

**方案 A**：放在执行计划消息里面。问题是，当用户滚动查看历史消息时，进度条会滚出视野，用户不知道当前执行到哪了。

**方案 B**：悬浮在输入框上方。无论用户怎么滚动，进度条始终可见。

代价是界面多了一个悬浮元素，不那么「干净」。但进度信息的持续可见性，值得这个代价。

收起状态只显示一行（当前任务 + 进度），点击可以展开看全部。大多数时候用户只需要知道「执行到哪了」，不需要看完整列表。

---

## @ Mention 的粒度选择

用户说「帮我改一下导航栏」，AI 可能不知道是哪个页面的导航栏。

所以我们支持 @ 引用画布上的内容。但引用到什么粒度？

**只支持节点级别**：`@首页`、`@用户中心`。实现简单，但不够精准。

**支持元素级别**：`@首页-导航栏`、`@首页-hero区域`。实现复杂，但沟通更精准。

我们选择了后者。因为 AI 辅助设计的核心价值是**精准执行用户意图**，如果用户没法精确表达想修改什么，AI 就只能猜，猜错了用户还要花时间纠正。

支持元素级别选择需要解析 Screen 的 HTML 结构、生成 CSS 选择器、渲染元素级别的高亮。技术复杂度增加了，但产品价值足够支撑。

---

## 思考消息：给想看的人看

AI 的思考过程要不要展示？

如果完全不展示，用户会觉得 AI 是个黑箱。如果全部展示，大段文字会淹没真正重要的内容。

我们的方案是**默认折叠，可选展开**。

普通用户只关心结果，不需要知道 AI 是怎么想的。但专业用户可能想了解推理过程，验证 AI 的逻辑是否正确。折叠状态满足前者，展开能力满足后者。

一个小细节：思考中显示跳动的动画（🧠 Thinking...），思考完成后变成可点击的折叠条。这样用户能区分「正在思考」和「思考完成」。

---

## 删除操作为什么不做二次确认

删除是高风险操作，常规做法是弹窗确认。但在 AI 辅助流程中，我们选择不确认。

原因是**上下文不同**。

用户手动点击删除按钮时，确认是必要的——防止误点。但在 AI 执行计划时，删除是计划的一部分，用户在点击「开始执行」时已经给予了授权。如果每个删除操作都弹窗确认，会打断整个工作流。

我们用明确的视觉反馈（🗑️ 图标 + "Deleted" 状态）代替弹窗确认。用户能看到删除发生了，如果有问题可以事后处理。

未来可以考虑增加「撤销」能力，但目前的场景下，确认弹窗弊大于利。

---

## 写在最后

回顾这些决策，核心其实就四个词：

**透明**——让用户知道 AI 在做什么  
**控制**——让用户决定何时开始、可以中断  
**效率**——重要的突出，次要的弱化  
**可追溯**——所有操作都有记录

AI 越强大，用户越需要掌控感。我们的目标不是做一个「全自动」的工具，而是做一个「用户可以信任并掌控」的协作伙伴。
